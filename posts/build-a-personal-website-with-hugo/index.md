# Build a Personal Website with Hugo


In this post, I will show you how to build a personal website with Hugo and configure the theme [DoIt](https://github.com/HEIGE-PCloud/DoIt).

<!--more-->

## Quick Start

Install [Hugo](https://gohugo.io/installation/) 

In macOS, you can use Homebrew to install Hugo.

```bash
brew install hugo
```

Then add the theme [DoIt](https://github.com/HEIGE-PCloud/DoIt) as a submodule of the hugo project.

1. Create a new hugo project:

   ```bash
   hugo new site my_website
   cd my_website
   ```

2. Initialize your project directory as a git repository, and add the theme repository as a submodule of your website directory:

   ```bash
   git init
   git submodule add https://github.com/HEIGE-PCloud/DoIt.git themes/DoIt
   ```

3. Initialize the project: `git submodule update --init --recursive`, and finish the installation.

4. Update the submodule: `git submodule update --remote --merge`.

5. Create your first post! `hugo new posts/hello-world.md`.

6. Preview your website: `hugo server --disableFastRender -D`.

```bash
.
â”œâ”€â”€ archetypes # markdown templates
â”œâ”€â”€ assets # assets used to generate the website
â”œâ”€â”€ content # website content, mainly posts
â”œâ”€â”€ data # data files used to generate the website
â”œâ”€â”€ public # static files generated by hugo, mainly publish this
â”œâ”€â”€ resources # resources generated by hugo, not sure what it is
â”œâ”€â”€ static # static files, e.g. images, thumbnails, etc.
â”œâ”€â”€ themes # hugo themes
â””â”€â”€ hugo.toml # configuration file
```

- `hugo.toml`: The configuration of Hugo, including the configuration of the theme. See [here](https://hugodoit.pages.dev/zh-cn/theme-documentation-basics/#site-configuration) for details.
- `content`: Save the content of the website, such as posts.

   ```bash
   .
   â””â”€â”€ content
      â””â”€â”€ about
      |   â””â”€â”€ index.md  // <- <https://example.com/about/>
      â”œâ”€â”€ posts
      |   â”œâ”€â”€ firstpost.md   // <- <https://example.com/posts/firstpost/>
      |   â”œâ”€â”€ happy
      |   |   â””â”€â”€ ness.md  // <- <https://example.com/posts/happy/ness/>
      |   â””â”€â”€ secondpost.md  // <- <https://example.com/posts/secondpost/>
      â””â”€â”€ quote
         â”œâ”€â”€ first.md       // <- <https://example.com/quote/first/>
         â””â”€â”€ second.md      // <- <https://example.com/quote/second/>
   ```

- `archetypes`: Save the markdown templates of the posts, usually including the front matter of the posts.
- `static`: Save the static files used in the posts, these files will be copied to the `public` folder when generating the website.
- `public`: The static HTML, CSS, JS, etc. generated by the `hugo` command. This folder is mainly published on the server.


## Deploy

We can create two repositories on GitHub to deploy the website.

- Repository 1: A repository used to host the source files of the website project, set the permission to Private. We will spend most of our time on this repository.
- Repository 2: A repository used to host the static files generated by the website, set the permission to Public. The name of this repository should be `{{your_github_username}}.github.io`. For example, my GitHub username is `fakephysicist`, then the name of the repository I need to create is `fakephysicist.github.io`. In the settings of this repository, enable GitHub Pages, set `Branch` to `main`, and set the static file location to `/(root)`. We will directly push the contents of the `public` folder generated by the `hugo` command to the `/` directory of the `main` branch.

Create these two repositories on GitHub, and then follow the steps below to deploy the website.

1. In the `my_website` directory, execute `git submodule update --init --recursive` to update the submodules to the latest state.
2. In `hugo.toml`, set `baseurl = https://fakephysicist.github.io/`.
3. Set the `fakephysicist.github.io` repository as a submodule and set it in the `public` folder.

   ```bash
   git submodule add -f -b main <https://github.com/fakephysicist/fakephysicist.github.io.git> public
   ```

4. Generate the website, and push the generated website to repository 2.

   ```bash
   hugo
   cd public
   git add .
   git commit -m "Build website"
   git push origin main
   cd ..
   ```

5. Add, commit and push repository 1.

   ```bash
   git add .
   git commit -m "Publish website"
   git push -u origin master
   ```

Next time you want to update the website, just execute the following script `deploy.sh`.

```bash
#!/bin/bash
set -e

# Optional: Custom commit message
commit_msg=${1:-"Update site"}

# Step 1: Ensure you're in the root of the Git repo
if [ ! -d ".git" ]; then
    echo "âŒ You must run this script from the root of the Git repository."
    exit 1
fi

# Step 2: Update the submodule if it's not initialized
if [ ! -d "public/.git" ]; then
    echo "â¡ï¸ Initializing submodule..."
    git submodule update --init --recursive
fi

# Step 3: Pull latest from GitHub Pages branch (optional, but safe)
echo "ğŸ”„ Updating submodule content..."
cd public
git checkout main
git pull origin main
cd ..

# Step 4: Generate the site into public/
echo "ğŸ— Running Hugo to build the site..."
hugo

# Step 5: Commit & push changes in public submodule
cd public
git add .
if git diff --cached --quiet; then
    echo "âœ… No changes in public to commit."
else
    git commit -m "$commit_msg"
    git push origin main
    echo "âœ… Pushed updates to GitHub Pages repo."
fi
cd ..

# Step 6: Commit & push changes in main repo (content, config, etc.)
git add .
if git diff --cached --quiet; then
    echo "âœ… No changes in main repo to commit."
else
    git commit -m "$commit_msg"
    git push origin main
    echo "âœ… Pushed changes to main repository."
fi

echo "ğŸš€ Deployment complete!"
```

If this script is saved in the root directory of the project, you can run it with the following command:

```bash
bash deploy.sh "<your commit message>"
```

## Get current timestamp

```bash
date +'%Y-%m-%dT%H:%M:%S%z' | sed 's/\(..\)$/:\1/'
```

One can use the above command to get the current timestamp in the format of `2024-08-04T14:20:29-07:00`.

This timestamp can be used in the front matter of the posts.

```yaml
date: 2021-01-01T02:43:06-05:00
lastmod: 2024-08-04T14:20:29-07:00
```
